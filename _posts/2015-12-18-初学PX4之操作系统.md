---
layout: post
title:  "初学PX4之操作系统"
categories: "drons_lifes"
author: nephne
tags: 工作生活
donate: true
comments: true
---
这篇文章主要是对PX4底层操作系统的熟悉，为后期的应用程序编写及飞控算法研究做准备。参考[官方文档](http://dev.px4.io/advanced-system-startup.html)做如下记载。

<!--more-->
####系统启动
PX4的开机是通过[ROMFS/px4fmu_common/init.d](https://github.com/PX4/Firmware/tree/master/ROMFS/px4fmu_common/init.d)文件夹里的shell脚本控制的。

所有以数字和下划线开头的文件属于包装的机身配置。他们在构建的时候被导出为airframes.xml文件，这些文件被QGroundControl解析作为机身选择界面。其余文件是通用启动逻辑的一部分，首先执行的文件是rcS脚本，通过它调用其它的脚本。

####调试系统启动
一个软件组件的驱动程序的失败可能导致中止启动。

	注意：一个不完整的引导往往体现在地面控制站缺少参数，因为非启动的应用程序没有初始化参数。

调试启动顺序正确的方法是，连接系统控制台然后给电路板重新上电。由此产生的引导日志具有启动序列的详细信息，并且应该包含提示为什么中止启动。

**常见的启动失败原因**

- 一个必须的传感器启动失败
- 对于自定义应用程序：系统内存溢出。运行free命令查看剩余的RAM
- 一个软件故障或断言导致堆栈轨迹

####个性化系统启动
自定义系统启动的最佳方式是介绍一种新的机身配置。如果只调整需要（如再启动一个应用或只是使用一个不同的混合器），在启动文件有特殊的钩子可以使用。

	警告：系统启动文件是UNIX文件，需要UNIX LINE ENDINGS，如果在windows上请使用合适的编辑器。

这里有三个钩子。注意，microSD卡的根文件夹的路径为`/fs/microsd`。

- /fs/microsd/etc/config.txt
- /fs/microsd/etc/extras.txt
- /fs/microsd/mixers/NAME_OF_MIXER

