---
layout: post
title:  "初学PX4之飞控算法"
categories: "drons_lifes"
author: 吴兴章
tags: 工作生活
donate: true
comments: true
---
学习应用程序就回到主线程上来了，这也是我研究px4的初衷，学习姿态估计与控制算法。    

<br>
####脚本分析
下面看下重要的一个[脚本](https://github.com/PX4/Firmware/blob/master/ROMFS/px4fmu_common/init.d/rc.mc_apps)`/etc/init.d/rc.mc_apps`，可以知道姿态估计用的是attitude_estimator_q和position_estimator_inav，用户也可以选择local_position_estimator、ekf2，而姿态控制应用为mc_att_control和mc_pos_control。

<!--more-->

```sh
#!nsh
#
# Standard apps for multirotors:
# att & pos estimator, att & pos control.
#

# The system is defaulting to INAV_ENABLED = 1
# but users can alternatively try the EKF-based
# filter by setting INAV_ENABLED = 0
if param compare INAV_ENABLED 1
then
	attitude_estimator_q start
	position_estimator_inav start
else
	if param compare LPE_ENABLED 1
	then
		attitude_estimator_q start
		local_position_estimator start
	else
		ekf2 start
	fi
fi

if mc_att_control start
then
else
	# try the multiplatform version
	mc_att_control_m start
fi

if mc_pos_control start
then
else
	# try the multiplatform version
	mc_pos_control_m start
fi

#
# Start Land Detector
#
land_detector start multicopter

```
<br>
####学写应用程序
在这之前，我们需要对在NuttX操作系统里怎么写应用程序做一个了解，这样好为下面的算法部分应用分析打好基础。    

下面我将参考下面这个[官方教程](http://dev.px4.io/tutorial-hello-sky.html)做一个大体的概括。    

1. 首先编写简单的应用[示例程序](https://github.com/PX4/Firmware/tree/master/src/examples/px4_simple_app)。主要有三个部分：头文件、外部声明、主函数。
2. 注册应用程序到NSH并编译。添加新的一行`examples/px4_simple_app`到[Firmware/cmake/configs/nuttx_px4fmu-v2_default.cmake](https://github.com/PX4/Firmware/blob/master/cmake/configs/nuttx_px4fmu-v2_default.cmake)，编译运行。
3. 连接到控制台。输入px4_simple_app

	```sh
	nsh > px4_simple_app
	Hello Sky!
	```
为了做一些有意义的事情，应用程序需要订阅输入和发布输出。两个应用程序之间独立的消息通道叫做*topics*。
4. 订阅传感器数据。

下面将分应用进行分析。
<br>
####姿态估算


<br>
####姿态控制

<br>
####参考文献
